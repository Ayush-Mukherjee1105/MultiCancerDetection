# Multi-Cancer Detection using Hybrid AI

This repository contains the complete source code for a research-grade AI system capable of detecting multiple types of cancer from a diverse range of medical images. The project leverages a novel hybrid architecture combining a Vision Transformer (ViT) for deep feature extraction and a Stacking Ensemble of classical machine learning models for robust classification.

The final model achieves **96% weighted F1-score** across 20 distinct classes from 5 different cancer datasets (Lung, Breast, Brain, Blood, and Colon).

![Streamlit Demo]![App](image.png)

## üìã Project Goal

The primary objective of this project was to build a unified, multi-domain AI model for medical image diagnosis. The system is designed to be:
- **Accurate:** Achieve high performance across multiple, distinct cancer types.
- **Robust:** Use an ensemble of models to ensure stable and reliable predictions.
- **Explainable:** Integrate SHAP (SHapley Additive exPlanations) to provide "whitebox" insights into the model's decision-making process.
- **Reproducible:** The entire pipeline, from data acquisition to evaluation, is fully automated with Python scripts.

## ü§ñ AI Architecture

The system employs a multi-stage hybrid pipeline:

1.  **Feature Extraction (Vision Transformer):** A pretrained Vision Transformer (`vit_base_patch16_224`) processes input images. Instead of classifying them directly, it acts as a powerful feature extractor, converting each image into a 768-dimensional vector (embedding) that captures its complex patterns and global context.

2.  **Classification (Stacking Ensemble):** These rich embeddings are then fed into a Stacking Ensemble classifier.
    -   **Base Models:** RandomForest and XGBoost make individual predictions based on the embeddings.
    -   **Meta-Model:** A Logistic Regression model acts as the final estimator, learning from the predictions of the base models to produce a final, highly accurate classification.

3.  **Class Balancing (SMOTE):** To prevent bias towards more common classes in the dataset, the training data is balanced using the Synthetic Minority Over-sampling Technique (SMOTE).

## üìä Final Results

The model was evaluated on a held-out test set of 4,725 images it had never seen before.

| Metric                 | Score |
| ---------------------- | :---: |
| **Accuracy**           | 95.7% |
| **Precision (Weighted)** | 95.7% |
| **Recall (Weighted)**    | 95.7% |
| **F1-Score (Weighted)**  | **95.7%** |

### Confusion Matrix

The confusion matrix below visualizes the model's performance on the test set, showing high accuracy across the strong diagonal.

![Confusion Matrix](outputs/stacking_ensemble_confusion_matrix.png)

## üõ†Ô∏è How to Run This Project

### 1. Prerequisites

- Python 3.9+
- An NVIDIA GPU with CUDA 11.8+ is **highly recommended** for performance.
- A Kaggle account and an API token (`kaggle.json`).

### 2. Setup

**a. Clone the repository:**
```bash
git clone <your-repo-url>
cd MultiCancerDetection
```

**b. Create a virtual environment:**
```bash
python -m venv .venv
# On Windows
.venv\Scripts\activate
# On macOS/Linux
source .venv/bin/activate
```

**c. Install dependencies from `requirements.txt`:**
```bash
pip install -r requirements.txt```

**d. Set up your Kaggle API token:**
   - Download your `kaggle.json` file from your Kaggle account page.
   - Place it in the required directory:
     - Windows: `C:\Users\<Your-Username>\.kaggle\kaggle.json`
     - macOS/Linux: `~/.kaggle/kaggle.json`
     - (You may need to run `chmod 600 ~/.kaggle/kaggle.json` on macOS/Linux).

### 3. Running the Pipeline

The project is executed as a sequence of scripts. Run them from the project's root directory.

**Step 1: Download and Prepare Data**
This script will download all 5 datasets from Kaggle, extract them, and organize them into a clean, unified structure. It also handles file conversions (e.g., `.tif` to `.png`).
```bash
python src/download_and_prepare.py
```

**Step 2: Generate Embeddings**
This script uses the Vision Transformer on a GPU to process all clean images and save their numerical embeddings to disk.
```bash
python src/embeddings.py
```

**Step 3: Train the Model**
This script loads the embeddings, applies SMOTE, and trains the final Stacking Ensemble model.
```bash
python src/train.py
```

**Step 4: Evaluate the Model**
This script runs the trained model on the test set and generates the classification report and confusion matrix.
```bash
python src/evaluate.py
```

### 4. Launch the Interactive Demo

After running the pipeline, you can launch the Streamlit web application to interact with the model.
```bash
streamlit run app.py
```
Open your web browser to the local URL provided by Streamlit.

## üìö Datasets Used

This project was trained on a combination of the following publicly available datasets from Kaggle:
- **Lung:** `adityamahimkar/iqothnccd-lung-cancer-dataset`
- **Breast:** `aryashah2k/breast-ultrasound-images-dataset`
- **Brain:** `masoudnickparvar/brain-tumor-mri-dataset`
- **Blood:** `sumithsingh/blood-cell-images-for-cancer-detection`
- **Colon:** `kmader/colorectal-histology-mnist`